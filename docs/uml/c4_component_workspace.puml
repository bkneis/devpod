@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

HIDE_STEREOTYPE()
LAYOUT_TOP_DOWN()

title Component diagram for DevPod

Person(user, "DevPod", "CLI or UI")
System(prov, "Provider", "Devpod Provider")
Component(ide, "IDE", "Local IDE")
Component(ctx, "Context", "Config, working dir etc.")
Component(env, "Local Env", "Shell variables, git credentials etc.")
Component(dc, ".devcontainer.json", "Dev container spec")
Component(git, "Git repo", "Project repo")

System_Boundary(cluster, "Machine / Cluster") {
  System(controlPlane, "Control plane", "Tunnels connection")
  Container_Boundary(ws, "Workspace") {
    Component(runner, "Dev container", "")
    Component(agent, "Agent", "")
    Component(ssh, "SSH server", "")
  }
}

BiRel_Right(user, prov, "devpod up ...")
BiRel(prov, controlPlane, "")
BiRel(controlPlane, agent, " gRPC")
BiRel_Left(agent, ssh, "Tunnelled STDIO")
Rel(agent, runner, " ")
BiRel(ssh, ide, "SSH port forwarding")
Rel(user, ide, " ")
Rel_Up(user, ctx, " ")
Rel_Left(user, env, " ")
Rel_Up(user, git, " ")
Rel_Up(user, dc, " ")
@enduml