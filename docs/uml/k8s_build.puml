@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
!include <material/common>
!include <material/sync>

LAYOUT_TOP_DOWN()

Person(user, "DevPod", "Uses kubectl")
System(prov, "Kubernetes Provider", "Devpod Provider")

System_Boundary(host, "Kubernetes Cluster") {
    System(controlPlane, "kube API server", "Manages the cluster")

    System_Boundary(devpodns, "devpod namespace") {
        
        Container_Boundary(kaniko1, "Workspace") {
            Container(kb1, "Kaniko Builder", "kaniko executor", "Resources")
            ContainerDb(cache, "Build Cache", "Volume", "local registry mirror")
            ContainerDb(dir, "Workspace Directory", "Volume", "workspace dir")
            Container(kr1, "Kaniko Runner", "kaniko executor", "Resources")
        }
    }
}

System_Boundary(registry, "External Registry") {
    System(registryCache, "Image Repository", "")
    System(cacheRepo, "Cache Repository", "")
}

BiRel(user, prov, "")
BiRel(prov, controlPlane, "kubectl ...")
Rel(controlPlane, kb1, " ")
Rel(registry, kb1, "")
Rel(kb1, kr1, "image")
@enduml